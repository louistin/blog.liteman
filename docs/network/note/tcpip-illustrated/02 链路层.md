# 02 链路层

* 链路层
    - 为 IP 模块发送和接收 IP 数据报
    - 为 ARP 模块发送 ARP 请求和接收 ARP 应答
    - 为 RARP 发送 RARP 请求和接收 RARP 应答

## 环回接口

**环回接口处理IP数据报流程**<br>
<img :src="$withBase('/image/network/tcpip-illustrated/02/lookback_interface_001.png')" alt="环回接口处理IP数据报流程">

```bash
Loopback Interface
允许运行在同一台主机上的客户程序和服务器程序通过 TCP/IP 进行通信.
    127.0.0.1(命名为 localhost)

1. 传给环回地址的任何数据均作为 IP 输入
2. 传给广播和多播地址的数据报会复制一份传给环回接口, 然后送到以太网上
3. 任何传给该主机 IP 地址的数据均送到环回接口
```

## 最大传输单元 MTU

```bash
MTU: 链路层以太网协议等对应的数据帧长度最大值(不包括以太网首部/尾部)
    以太网 MTU : 1500
    Internet MTU : 576
    IP 层数据报长度超出链路层 MTU 时, IP 层需要进行分片(fragmentation)

路径 MTU: 两台通信主机路径中最小 MTU
    路径 MTU 受两端各自方向选路不同, 两台主机间 MTU 值可能不一样
```


```bash
[root@ ~]# ifconfig -a
docker0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 172.18.0.1  netmask 255.255.0.0  broadcast 172.18.255.255
        inet6 fe80::42:1eff:fe10:960f  prefixlen 64  scopeid 0x20<link>
        ether 02:42:1e:10:96:0f  txqueuelen 0  (Ethernet)
        RX packets 624  bytes 106169 (103.6 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 502  bytes 1028258 (1004.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

# eth0 以太网接口, 支持以太网协议
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.17.0.2  netmask 255.255.240.0  broadcast 172.17.15.255
        inet6 fe80::5054:ff:fe1d:9861  prefixlen 64  scopeid 0x20<link>
        ether 52:54:00:1d:98:61  txqueuelen 1000  (Ethernet)
        RX packets 9750326  bytes 2354351488 (2.1 GiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 9518774  bytes 1918820423 (1.7 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

# loopback 接口, 支持 loopback 协议
lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 7527  bytes 369759 (361.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 7527  bytes 369759 (361.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

# 查看各个链路层协议 MTU 值
[root@ ~]# netstat -in
Kernel Interface table
Iface             MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
docker0          1500      624      0      0 0           502      0      0      0 BMU
eth0             1500  9750648      0      0 0       9519116      0      0      0 BMRU
lo              65536     7527      0      0 0          7527      0      0      0 LRU
```